# PythonQuantTrading

## Necessary Plugin:
typing_extensions:
一個為 Python 型別提示的工具，能在型別提示中附加額外說明，適合在函式參數中提供更詳細的描述。

typing
python-dotenv
yfinance
finlab

如何使用 Alphalens
1. 準備數據：首先，需要準備好股價資料和因子資料，這些資料將作為後續分析的基礎
2. 整理數據：將取得的資料整理成符合 Alphalens 規定的格式，以便能夠進行有效分析
3. 計算因子數值與未來收益：使用 get_clean_factor_and_forward_returns 韓式還計算因子數值及其對應的未來收益表
  這一部會產生 Alphalens 後續分析所需的清理過的因子數據和收益數據
4. 生成因子分析報表：最後，使用 create_full_tear_sheet 函式來生成最終的因子分系報表該報表提供完整的因子表現評估，幫助我們理解因子的有效性及其對投資收益的影響

Reference:
https://blog.csdn.net/gitblog_00829/article/details/146565207


1天未來收益(1D) = (明天價格-今天價格)/今天價格
5天未來收益(5D) = (5天後的價格-今天價格)/今天價格
10天未來收益(10D) = (10天後的價格-今天價格)/今天價格

### 53個財務因子
營業利益、EBITDA、營運現金流、歸屬母公司淨利、折舊、流動資產、流動負債、取得不動產廠房及設備、經常稅後淨利、ROA稅後息前、ROA綜合損益
、ROE稅後、ROE綜合損益、稅前息前折舊前淨利率、營業毛利率、營業利益率、稅前淨利率、稅後淨利率、業外收支營收率、貝里比率、營業費用率、推銷費用率
、管理費用率、研究發展費用率、現金流量比率、稅率、每股營業額、每股營業利益、每股現金流量、每股睡前淨利、每股綜合損益、每股稅後淨利、總負債廚總淨值
、負債比率、淨值除資產、營收成長率、營業毛利成長率、資產總額成長率、淨值成長率、流動比率、速動比率、利息支出率、營運資金、總資產周轉次數、應收帳款週轉率
、存貨週轉率、固定資產周轉次數、淨值周轉率次數、自由現金流量


### 在金融市場中，投資策略的建構主要依賴的兩種核心：擇時模型跟擇股模型
擇時模型：用來判斷進入或退出市場的最佳時機，適合用於操作ETF等綜合性金融產品，或是台指期這樣反映整體市場的期貨產品(P1-73)
擇股模型：用於預測市場走勢，幫助投資者決定何時進場以把握市場機會，何時退出以降低風險(P1-73)

### 具有良好區分能力的9種因子
營業利益
營運現金流
歸屬母公司淨利
經常稅後淨利
ROE稅後
營業利益成長率
稅後淨利成長率
稅前淨利成長率

### 主成份分析法
在資料分析中，主成份分析的目的是從大量的變數中，透過組合的方式來生成少數新的變數，這些新變數稱為「主成份」。
主成份是基於原始變數生成的，能夠捕捉資料中的大部分重要資訊，同時，主成份的數量會比原始變數少，從而有效降低數據的複雜性。
透過此分析，可以去除一些資訊量較少的變數，或者去除那些傳達相似資訊的變數，讓我們能夠更聚焦在最重要的部分。
例如：
「營業利益」、「營業利益率」、「營業營收比」這三個只表可能都在傳達相似的資訊，透果主成份分析，可能就會將它們合併為一個與營業相關的主成份，這樣就大大減少了變數的數量，同時保留了數據中最關鍵的訊息。


### 熱力圖
熱力圖是因子與未來收益相關性的波動情況。如果顏色變化劇烈，代表因子在不同時間段與收益間的相關性波動較大，顯示因子與收益間的關係不穩定；相反，顏色一致則表示因子與收益的相關性較穩定。

### 模型選擇
靜態選股模型：
使用「固定的單因子」或「固定的多因子組合」來建立選股策略。這類模型的優點在於操作簡單，特別適合那些對市場變動不敏感、且能在長期內保持穩定效果的因子。假如每一季都使用「營業發展累用率」因子來選擇股票．前4名的股票進行買入，後4名的股票進行賣出(先賣後買的策略)，當下一季跌出前4名或後4名的時候就對股票進行平倉(賣出/買入)。
動態選股模型：
動態選股模型會隨著時間的推移進行滾動更新．根據每個時期的最佳因子來調整選股策略。其核心在於「因子的輪動性」，因為不同的因子表現會隨著市場條件變化而有所不同。在某些市場條件下，特定因子可能表現優異，但在其他時期則可能有不同的因子更具優勢。例如在2014年的第一季「營業發顫費用率」，但到了下一季如果「稅後淨利成長率」的表現更加，那麼便在下一季改用這個因子進行選股，一樣每一季的前4名進行買入，後4名進行賣出，在下一季跌出前4名或後4名的時候就對股票進行平倉(賣出/買入)。

至於要用哪種模型，因該去觀測財報因子表現的穩定性，如果一個因子長期表現穩定，那可以選擇相對簡單的靜態選股模型，相反的，動態選股模型會更適合(P105)


### 常見回測框架
Backtrader(pip install backtrader)
Backtest
Vnpy
Zipline


### 視覺化呈現框架
Pyfolio(pip install pyfolio-reloaded)


### Backtrader
Backtrader 在 bt.Strategy 中常見的內建方法：
__init__(): 初始化方法，在策略開始時執行，用於設置指標，包含定義策略會使用到的參數
next()：每個時間步驟執行的方法，用於定義交易策略邏輯的函式
notify_order()：追蹤訂單的狀態，「訂單狀態」變化時自動觸發。訂單狀態包含了提交、接受、完成、取消、拒絕等狀態
notify_trade()：追蹤交易的狀態，「交易狀態」變化時自動觸發。任何已經平倉的交易的可以在滯個方法裡面顯示利潤
stop()：策略結束時執行的方法
buy()：建立一個買出訂單，但還沒執行，會在下一個交易時間點執行買入動作。關於訂單的執行狀態可以透過 notify_order 來得知
sell()：建立一個賣出訂單，但還沒執行，會在下一個交易時間點執行買入動作。關於訂單的執行狀態可以透過 notify_order 來得知
log()：定義回測執行過程中要輸出的內容，可以幫助我們了解策略執行的狀態

### 
收益 Return：
收益涵蓋了幾個關鍵指標，例如：每日收益(returns)、每月收益(Monthly returns)、年化收益(Annual returns)和累積收益(Cumulative returns)。這些指標幫助我們從不同的時間維度去了解策略的表現。(P1-134)

波動性 Volatility：
毛數資慘價格在一定時間內的變化幅度，是用來評估風險的重要指標。策略的波動性高代表資產的變動幅度大。(P1-136)

夏普比率 Sharpe ratio：
用來衡量每單位風險所帶來的超額報酬，數值愈高表示該投資在考慮風險後的收益表現越好。(P1-137)

最大回撤 Max Drawdown：
回撤是衡量投資從最高點到最低點的損失幅度，是評估風險的重要指標之一。可讓投資者了解在最不利的市場條件下，可能會面臨多大的損失(P1-138)

